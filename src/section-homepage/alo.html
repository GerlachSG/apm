<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TESTE DO SLIDER</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    
    <style>
        /* CSS GERAL */
        * {
            margin:0;
            padding:0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            font-family: "Inter", sans-serif;
            background-color: #F0F0F0;
            color: #000;
        }
        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* CSS DO SLIDER */
        .slider {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        .slider-container {
            position: absolute;
            width: 30%;
            height: 70%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 2;
        }
        .slide-img {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .slide-img img {
            transform: scale(1.5);
            opacity: 0.75;
            transition: transform 0.5s ease, opacity 0.5s ease;
        }
        .slider-container.active .slide-img img {
            opacity: 1;
            transform: scale(1.2);
        }
        .slider-container.active {
            width: 30%;
            aspect-ratio: 4/5;
            height: auto !important;
        }
        .slider-container:hover .slide-img img {
            transform: scale(1.3);
        }
        .slider-counter, .slider-items, .slider-preview, .progress-container {
            position: absolute;
            z-index: 5;
        }
        .slider-counter { left: 50%; transform: translateX(-50%); bottom: 2.5em; }
        .slider-items { left: 2.5em; bottom: 2.5em; }
        .slider-preview { top:25%; left:50%; transform: translateX(-50%); width: 75%; height: 100%; z-index:0; opacity: 0.5; overflow: hidden; }
        .slider-preview img { position: absolute; top: 0; }
        .progress-container { right: 30px; bottom: 5px; }
        .progress-circle { width: 90px; height: 90px; opacity: 0.7; }
        .progress-circle-fill { transition: stroke-dashoffset 0.1s linear; }
        .slider-items p.activeItem { color:#000; font-weight: bold; }

        /* --- CSS DAS LEGENDAS (COM O TESTE VERMELHO) --- */
        .slide-label {
            position: absolute;
            bottom: -50px;
            left: 0;
            width: 100%;
            color: white; /* Letra branca para contrastar */
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            
            /* ===== TESTE ===== */
            background-color: red;
            padding: 5px;
            z-index: 1000;
            opacity: 1 !important; /* Força a opacidade para o teste */
        }
        .slide-label::before {
            font-size: 20px;
            line-height: 1;
        }
        .slider-container.next .slide-label {
            justify-content: flex-start;
            padding-left: 15px;
        }
        .slider-container.next .slide-label::before {
            content: '→';
            order: 2;
        }
        .slider-container.prev .slide-label {
            justify-content: flex-end;
            padding-right: 15px;
        }
        .slider-container.prev .slide-label::before {
            content: '←';
            order: -1;
        }
    </style>
</head>
<body>

    <section class="section-slide">
        <div class="slider">
            <div class="slider-counter"><p><span>1</span>/<span>6</span></p></div>
             <div class="slider-items">
                <p class="activeItem">Dia das Mulheres</p>
                <p>Novo E-Commerce APPM</p>
                <p>Conscientização Setembro</p>
                <p>Dia do Autista</p>
                <p>Gincana 2025</p>
                <p>Projetos para o Mundo</p>
            </div>
             <div class="slider-preview"></div>
             <div class="progress-container">
                <svg class="progress-circle" width="40" height="40" viewBox="0 0 40 40">
                  <circle class="progress-circle-bg" cx="20" cy="20" r="18" fill="none" stroke="#e6e6e6" stroke-width="1"/>
                  <circle class="progress-circle-fill" cx="20" cy="20" r="18" fill="none" stroke="#000" stroke-width="1" 
                          stroke-dasharray="113" stroke-dashoffset="113" transform="rotate(-90 20 20)"/>
                </svg>
              </div>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/CustomEase.min.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            gsap.registerPlugin(CustomEase);
            CustomEase.create("hop", "M0,0 C0.488,0.082 0.467,0.286 0.5,0.5 0.532,0.712 0.561,1 1,1");

            const progressCircle = document.querySelector(".progress-circle-fill");
            const slider = document.querySelector(".slider");
            const sliderCounter = document.querySelector(".slider-counter p span:first-child");
            const sliderItems = document.querySelector(".slider-items");
            const sliderPreview = document.querySelector(".slider-preview");
            
            const totalSlides = 6;
            let activeSlideIndex = 1;
            let isAnimating = false;
            let autoplayTimer = null;
            const autoplayDelay = 5000;

            const sliderContent = [
                { name: "Dia das Mulheres", img: "https://i.imgur.com/83DnY1w.jpeg", link: "#mulheres" },
                { name: "Novo E-Commerce APPM", img: "https://i.imgur.com/T0a09I5.png", link: "#ecommerce" },
                { name: "Conscientização Setembro", img: "https://i.imgur.com/83DnY1w.jpeg", link: "#setembro" },
                { name: "Dia do Autista", img: "https://i.imgur.com/T0a09I5.png", link: "#autista" },
                { name: "Gincana 2025", img: "https://i.imgur.com/83DnY1w.jpeg", link: "#gincana" },
                { name: "Projetos para o Mundo", img: "https://i.imgur.com/T0a09I5.png", link: "#projetos" },
            ];

            const clipPath = {
                closed: "polygon(25% 30%, 75% 30%, 75% 70%, 25% 70%)",
                open: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
            };

            const slidePositions = {
                prev: { left: "15%", rotation: -90 },
                active: { left: "50%", rotation: 0 },
                next: { left: "85%", rotation: 90 },
            };

            function startAutoplay() {
                if (autoplayTimer) clearTimeout(autoplayTimer);
                gsap.killTweensOf(progressCircle);
                animateProgressCircle();
                autoplayTimer = setTimeout(() => {
                    if (!isAnimating) transitionSlides("next");
                }, autoplayDelay);
            }

            function animateProgressCircle() {
                gsap.set(progressCircle, { strokeDashoffset: 113 });
                gsap.to(progressCircle, { strokeDashoffset: 0, duration: autoplayDelay / 1000, ease: "linear" });
            }

            function createSlide(content, className) {
                const slide = document.createElement("div");
                slide.className = `slider-container ${className}`;
                slide.innerHTML = `
                    <div class="slide-img"><img src="${content.img}" alt="${content.name}"></div>
                    <a href="${content.link}" class="continue-button">Continuar</a>
                    <div class="slide-label"></div>
                `;
                return slide;
            }

            function getSlideIndex(increment) {
                return ((activeSlideIndex + increment - 1 + totalSlides) % totalSlides) + 1;
            }

            function updateCounterAndHighlight(index) {
                if (!sliderCounter || !sliderItems) return;
                sliderCounter.textContent = index;
                sliderItems.querySelectorAll("p").forEach((item, i) => 
                    item.classList.toggle("activeItem", i === index - 1)
                );
            }

            function updatePreviewImage(content) {
                if(!sliderPreview) return;
                const newImage = document.createElement("img");
                newImage.src = content.img;
                newImage.alt = content.name;
                sliderPreview.innerHTML = ''; // Limpa antes de adicionar
                sliderPreview.appendChild(newImage);
            }
            
            function updateSlideLabel(slide, index, show) {
                if (!slide) return;
                const label = slide.querySelector('.slide-label');
                if (label) {
                    if (show) {
                        const content = sliderContent[index - 1];
                        const formattedIndex = String(index).padStart(2, '0');
                        label.innerHTML = `<span>${content.name} / ${formattedIndex}</span>`;
                    }
                    // A animação de opacidade está desativada por causa do !important no CSS de teste
                    gsap.to(label, { opacity: show ? 1 : 0, duration: 0.8, delay: show ? 0.5 : 0 });
                }
            }

            function animateSlide(slide, props) {
                if (!slide) return;
                gsap.to(slide, { ...props, duration: 2, ease: "hop" });
                const slideImg = slide.querySelector(".slide-img");
                if (slideImg) {
                    gsap.to(slideImg, { rotation: -props.rotation, duration: 2, ease: "hop" });
                }
            }

            function transitionSlides(direction) {
                if (isAnimating) return;
                isAnimating = true;

                const [outgoingPos, incomingPos] = direction === "next" ? ["prev", "next"] : ["next", "prev"];
                const outgoingSlide = slider.querySelector(`.${outgoingPos}`);
                const activeSlide = slider.querySelector(".active");
                const incomingSlide = slider.querySelector(`.${incomingPos}`);

                if (!outgoingSlide || !activeSlide || !incomingSlide) {
                    isAnimating = false;
                    return;
                }

                animateSlide(incomingSlide, { ...slidePositions.active, clipPath: clipPath.open });
                animateSlide(activeSlide, { ...slidePositions[outgoingPos], clipPath: clipPath.closed });
                gsap.to(outgoingSlide, { scale: 0, opacity: 0, duration: 1.5, ease: "hop" });

                const newActiveIndex = getSlideIndex(direction === "next" ? 1 : -1);
                const newPrevNextIndex = getSlideIndex(direction === "next" ? 0 : 0);
                const newSlideIndex = getSlideIndex(direction === "next" ? 2 : -2);
                
                const newSlide = createSlide(sliderContent[newSlideIndex - 1], incomingPos);
                slider.appendChild(newSlide);
                
                gsap.set(newSlide, { ...slidePositions[incomingPos], xPercent: -50, yPercent: -50, clipPath: clipPath.closed, opacity: 0, scale: 0 });
                gsap.set(newSlide.querySelector(".slide-img"), { rotation: -slidePositions[incomingPos].rotation });
                gsap.to(newSlide, { scale: 1, opacity: 1, duration: 1.5, ease: "hop" });

                updateSlideLabel(incomingSlide, activeSlideIndex, false);
                updateSlideLabel(activeSlide, newPrevNextIndex, true);
                updateSlideLabel(newSlide, newSlideIndex, true);
                
                updatePreviewImage(sliderContent[newActiveIndex - 1]);
                setTimeout(() => updateCounterAndHighlight(newActiveIndex), 1000);

                setTimeout(() => {
                    if (outgoingSlide && outgoingSlide.parentNode) outgoingSlide.remove();
                    activeSlide.className = `slider-container ${outgoingPos}`;
                    incomingSlide.className = "slider-container active";
                    newSlide.className = `slider-container ${incomingPos}`;
                    activeSlideIndex = newActiveIndex;
                    isAnimating = false;
                    startAutoplay();
                }, 2000);
            }

            function initializeSlider() {
                const slideContainers = slider.querySelectorAll('.slider-container');
                slideContainers.forEach(el => el.remove());
                
                const prevIndex = getSlideIndex(-1);
                const activeIndex = activeSlideIndex;
                const nextIndex = getSlideIndex(1);
                
                const prevSlide = createSlide(sliderContent[prevIndex - 1], "prev");
                const activeSlide = createSlide(sliderContent[activeIndex - 1], "active");
                const nextSlide = createSlide(sliderContent[nextIndex - 1], "next");
                
                slider.appendChild(prevSlide);
                slider.appendChild(activeSlide);
                slider.appendChild(nextSlide);
                
                updateSlideLabel(prevSlide, prevIndex, true);
                updateSlideLabel(nextSlide, nextIndex, true);

                Object.entries(slidePositions).forEach(([key, value]) => {
                    slider.querySelectorAll(`.slider-container.${key}`).forEach(slideElement => {
                        gsap.set(slideElement, {
                            ...value, xPercent: -50, yPercent: -50,
                            clipPath: key === "active" ? clipPath.open : clipPath.closed,
                        });
                        if (key !== "active") {
                            const imgElement = slideElement.querySelector(".slide-img");
                            if (imgElement) gsap.set(imgElement, { rotation: -value.rotation });
                        }
                    });
                });
                updatePreviewImage(sliderContent[activeIndex - 1]);
            }

            slider.addEventListener("click", (e) => {
                if (isAnimating) return;
                if (e.target.closest('.continue-button')) { return; }
                const clickedSlide = e.target.closest(".slider-container");
                if (clickedSlide) {
                    if (autoplayTimer) clearTimeout(autoplayTimer);
                    gsap.killTweensOf(progressCircle);
                    transitionSlides(clickedSlide.classList.contains("next") ? "next" : "prev");
                }
            });

            initializeSlider();
            updateCounterAndHighlight(activeSlideIndex);
            startAutoplay();
        });
    </script>
</body>
</html>